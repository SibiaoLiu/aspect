## Global parameters
set Dimension                                        = 3
set Start time                                       = 0
set End time                                         = 1e8
set Output directory                                 = output_chunk3d
set Use years in output instead of seconds           = true
set CFL number                                       = 0.5
set Maximum time step                                = 1e5
set Adiabatic surface temperature                    = 1573
set Pressure normalization                           = surface
set Surface pressure                                 = 0

#Assimilation function plugin
set Additional shared libraries            = ../libprescribed_temperature.so
set Prescribe internal temperature         = true
set LAB_depth = false
set OLAB depth = 100e3
set CLAB depth = 200e3
set Thermal top boundary depth = 250e3
set Weak zone size = 5
set Age_continent = 200

## Solver opitions
set Nonlinear solver scheme                 = single Advection, iterated Stokes
set Nonlinear solver tolerance              = 1e-4
set Max nonlinear iterations                = 100
set Max nonlinear iterations in pre-refinement       = 0

subsection Solver parameters
  subsection Stokes solver parameters
    set Linear solver tolerance                      = 1e-7
    set Number of cheap Stokes solver steps          = 0
    set Use direct solver for Stokes system          = false
  end
end

subsection Discretization
  set Use discontinuous temperature discretization = true
  subsection Stabilization parameters
    set Global temperature maximum = 1653
    set Global temperature minimum = 273
#    set Use artificial viscosity smoothing = true
  end
end

# Gravity model
subsection Gravity model
  set Model name                                     = radial constant
  subsection Radial constant
    set Magnitude                                    = 9.81
  end
end

subsection Geometry model
  set Model name                                     = chunk
  subsection Chunk
    set Chunk minimum longitude                      = 260      # degrees; 100W
    set Chunk maximum longitude                      = 340        # 20W
    set Longitude repetitions                        = 1
    set Chunk minimum latitude                       = -60
    set Chunk maximum latitude                       = 20
    set Latitude repetitions                         = 1
    set Chunk inner radius                           = 3481e3
    set Chunk outer radius                           = 6371e3
    set Radius repetitions                           = 1
   end
end 

# Mesh refinement specifications 
subsection Mesh refinement
  set Initial global refinement                      = 4
  set Initial adaptive refinement                    = 0
  set Time steps between mesh refinement             = 0
  set Strategy                                       = minimum refinement function
  set Run postprocessors on initial refinement       = true
  subsection Minimum refinement function
    set Coordinate system                            = spherical
    set Variable names                               = r,longi,lati
    set Function constants                           = h1=6271e3, h2=6171e3
    set Function expression                          = if(r>=h1,4,  if(r>h2 &r<h1, 3, 0))
  end
end

# Temperature condition
subsection Boundary temperature model
  set Fixed temperature boundary indicators          = outer,inner
  set List of model names                            = spherical constant
  subsection Spherical constant
    set Inner temperature                            = 1653
    set Outer temperature                            = 273
  end
end

subsection Initial temperature model
  set Model name = age_assimilation_T
  subsection Age assimilation model 
    set Data directory = /work/06430/sibiao/frontera/InputModels/assimilation_age/assim_age_100-20W_60S-20N/
    set Data file name = assim_age_iniT.%d.dat
    set Data file time step = 1e6 
    set First data file number = 101
    set Decreasing file order = true
    set Maximum oceanic plate thickness = 100e3
    set Maximum oceanic plate temperature = 1613
    set Maximum continental plate thickness = 200e3
    set Maximum continental plate temperature = 1653
  end 
end

subsection Boundary velocity model
  set Tangential velocity boundary indicators = inner, north, south, west, east, outer
end

# Composition condition
subsection Boundary composition model
  set List of model names                            = initial composition
end

subsection Compositional fields
  set Number of fields                               = 7
  set Names of fields                                = OC, OLM, CC, CLM, AS, TZ, LM
end

subsection Initial composition model
  set List of model names = age_assimilation_C
  subsection Age assimilation model
    set Data directory = /work/06430/sibiao/frontera/InputModels/assimilation_age/assim_age_100-20W_60S-20N/
    set Data file name = assim_age_iniT.%d.dat
    set Data file time step = 1e6
    set First data file number = 101
    set Decreasing file order = true
    set Oceanic crustal thickness = 40e3
    set Oceanic lithospheric mantle thickness = 60e3
    set Continental crustal thickness = 60e3
    set Continental lithospheric mantle thickness = 140e3
    set Transition zone top = 410e3
    set Transition zone bottom = 660e3
    set Weak zone size = 5
    set Age_continent = 200
  end
end

subsection Material model
  set Model name = visco plastic
  subsection Visco Plastic
    set Reference temperature = 1633 
    set Reference viscosity   = 1e21
    set Minimum strain rate   = 1e-20
    set Reference strain rate = 1e-15
    set Minimum viscosity     = 1e20
    set Maximum viscosity     = 1e23 
   # Thermal diffusivity is adjusted to match thermal conductivities (k) \
   # kappa=k/(rho*Cp), m2/s, assumed in assigning the initial geotherm
    set Thermal diffusivities =  8.333333e-7, 7.142857e-7, 8.333333e-7, \
                                 7.142857e-7, 8.333333e-7, 8.333333e-7, \
                                 8.333333e-7, 8.333333e-7
    set Heat capacities       =  1200
    set Densities             =  3300, 3000, 3280, 3000, 3280, 3300, 3300, 3350
    set Thermal expansivities =  3e-5, 2.7e-5, 3e-5, 2.7e-5, 3e-5, 3e-5, 3e-5, 3e-5

   # Composition layers:        [background, OC, OLM, CC, CLM, AS, TZ, LM]
    set Viscous flow law      = diffusion
    set Viscosity averaging scheme = harmonic
   # Diffusion creep
    set Prefactors for diffusion creep            = 0.5e-21, 0.5e-24, 0.5e-22, \
                                                    0.5e-24, 0.5e-22, 0.5e-21, \
                                                    0.5e-22, 0.5e-23
    set Activation energies for diffusion creep   = 0
    set Grain size exponents for diffusion creep  = 1
    set Grain size                                = 1
   
   # Plasticitity parameters - Default setting

  end
end
                    


### Output for post processing

subsection Postprocess
  set List of postprocessors                        = visualization, velocity statistics, \
                                                      temperature statistics, heat flux statistics
  subsection Visualization
    set List of output variables                    = density,viscosity,strain rate, adiabat
    set Interpolate output                          = true
    set Output format                               = vtu
    set Time between graphical output               = 1e6
    set Number of grouped files                     = 1
  end
end

